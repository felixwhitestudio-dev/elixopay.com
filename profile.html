<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>โปรไฟล์ผู้ใช้ - Elixopay</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="/js/api-config.js"></script>
</head>

<body class="bg-gray-50">
    <div class="max-w-xl mx-auto py-10 px-4">
        <h2 class="text-2xl font-bold mb-6 text-center" data-i18n="profile.title">โปรไฟล์ผู้ใช้</h2>
        <form id="kyc-form" class="bg-white rounded-lg shadow p-6 space-y-6">
            <div>
                <label class="block text-gray-700 mb-1" data-i18n="profile.fullname">ชื่อ-นามสกุล</label>
                <input type="text" name="fullname" id="fullname" class="w-full border rounded px-3 py-2" required />
            </div>
            <div>
                <label class="block text-gray-700 mb-1" data-i18n="profile.idcard">เลขบัตรประชาชน</label>
                <input type="text" name="idcard" id="idcard" maxlength="13" class="w-full border rounded px-3 py-2"
                    required />
            </div>
            <div>
                <label class="block text-gray-700 mb-1" data-i18n="profile.bank">ธนาคาร</label>
                <select name="bank" id="bank" class="w-full border rounded px-3 py-2" required>
                    <option value="" data-i18n="profile.bank.select">-- เลือกธนาคาร --</option>
                    <option value="kbank">Kasikornbank</option>
                    <option value="bbl">Bangkok Bank</option>
                    <option value="scb">SCB</option>
                    <option value="ktb">Krungthai</option>
                    <option value="tmb">TTB</option>
                    <option value="bay">Krungsri</option>
                </select>
            </div>
            <div>
                <label class="block text-gray-700 mb-1" data-i18n="profile.account">เลขที่บัญชี</label>
                <input type="text" name="bank_account" id="bank_account" maxlength="20"
                    class="w-full border rounded px-3 py-2" required />
            </div>
            <button type="submit"
                class="w-full py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition"
                data-i18n="profile.save">บันทึกข้อมูล</button>
            <div id="kyc-message" class="mt-4 text-center text-sm"></div>
        </form>
    </div>
    <script src="js/i18n.js"></script>
    <script>
        // Load Profile Data
        window.addEventListener('DOMContentLoaded', async () => {
            try {
                // Use apiFetch to support Demo Mode interception
                // In a real app, this endpoint would return the user's profile
                const response = await window.apiFetch(window.API_CONFIG.ENDPOINTS.auth.me);
                const data = await response.json();

                if (data.success && data.data && data.data.user) {
                    const user = data.data.user;
                    // Pre-fill data if available (Mock data structure might need adjustment depending on what we return)
                    document.getElementById('fullname').value = (user.first_name || '') + ' ' + (user.last_name || '');
                    // Other fields might not be in the basic auth user object, but we simulate fetching them
                }
            } catch (error) {
                console.error("Failed to load profile", error);
            }
        });

        // Save Profile Data
        document.getElementById('kyc-form').onsubmit = async function (e) {
            e.preventDefault();
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalText = submitBtn.textContent;
            submitBtn.disabled = true;
            submitBtn.textContent = '...';

            // Simulate API delay
            setTimeout(() => {
                const msg = window.ElixopayI18n ? window.ElixopayI18n.t('profile.saved') : 'บันทึกข้อมูลเรียบร้อยแล้ว';
                const msgEl = document.getElementById('kyc-message');
                msgEl.textContent = msg;
                msgEl.className = 'mt-4 text-center text-sm text-green-600';

                submitBtn.disabled = false;
                submitBtn.textContent = originalText;
            }, 1000);
        };
    </script>
</body>

</html>