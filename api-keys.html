<!DOCTYPE html>
<html lang="th">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>API Keys - Elixopay</title>
	<link rel="stylesheet" href="styles/theme.css">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/js/all.min.js" defer></script>
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
	<script src="js/api-config.js"></script>
	<style>
		body { font-family: 'Inter', system-ui, sans-serif; background: #0d1117; color: #e2e8f0; margin:0; }
		body.light { background:#f8fafc; color:#0f172a; }
		.topbar { background:#1e293b; padding:1rem 2rem; display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid rgba(255,255,255,.08); }
		body.light .topbar { background:#ffffff; border-bottom-color:#e2e8f0; }
		.logo { font-weight:700; font-size:1.5rem; color:#6366f1; text-decoration:none; }
		.nav-links { display:flex; gap:1.5rem; align-items:center; }
		.nav-links a { color:#94a3b8; text-decoration:none; transition:color .2s; }
		.nav-links a:hover { color:#e2e8f0; }
		.nav-links a.active { color:#6366f1; font-weight:600; }
		body.light .nav-links a { color:#64748b; }
		body.light .nav-links a:hover { color:#0f172a; }
		.container { max-width:1200px; margin:0 auto; padding:2rem 1.5rem; }
		.header { margin-bottom:2rem; }
		.header h1 { font-size:2rem; margin:0 0 .5rem; }
		.header p { color:#94a3b8; margin:0; }
		.btn { padding:.75rem 1.5rem; border-radius:8px; font-size:.9rem; font-weight:600; cursor:pointer; border:none; transition:all .2s; text-decoration:none; display:inline-flex; align-items:center; gap:.5rem; }
		.btn-primary { background:#6366f1; color:#fff; }
		.btn-primary:hover { background:#4f46e5; }
		.btn-danger { background:#ef4444; color:#fff; }
		.btn-danger:hover { background:#dc2626; }
		.btn-outline { background:transparent; border:1px solid rgba(99,102,241,.3); color:#6366f1; }
		.btn-outline:hover { background:rgba(99,102,241,.1); border-color:#6366f1; }
		.card { background:#1e293b; border-radius:12px; border:1px solid rgba(255,255,255,.08); overflow:hidden; margin-bottom:2rem; }
		body.light .card { background:#ffffff; border-color:#e2e8f0; }
		.card-header { padding:1.5rem; border-bottom:1px solid rgba(255,255,255,.08); display:flex; justify-content:space-between; align-items:center; }
		body.light .card-header { border-bottom-color:#e2e8f0; }
		.card-title { font-size:1.25rem; font-weight:700; margin:0; }
		.key-item { padding:1.5rem; border-bottom:1px solid rgba(255,255,255,.08); display:flex; justify-content:space-between; align-items:center; }
		body.light .key-item { border-bottom-color:#e2e8f0; }
		.key-item:last-child { border-bottom:none; }
		.key-info { flex:1; }
		.key-name { font-weight:600; margin-bottom:.25rem; }
		.key-value { font-family: 'Courier New', monospace; background:rgba(99,102,241,.1); padding:.5rem 1rem; border-radius:6px; font-size:.85rem; display:inline-block; margin:.5rem 0; }
		.key-meta { font-size:.85rem; color:#94a3b8; }
		.badge { display:inline-block; padding:.25rem .75rem; border-radius:6px; font-size:.75rem; font-weight:600; margin-left:.5rem; }
		.badge-live { background:rgba(34,197,94,.15); color:#22c55e; }
		.badge-test { background:rgba(251,191,36,.15); color:#fbbf24; }
		.key-actions { display:flex; gap:.5rem; }
		.empty-state { text-align:center; padding:4rem 2rem; color:#94a3b8; }
		.modal { display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,.7); z-index:1000; align-items:center; justify-content:center; }
		.modal.active { display:flex; }
		.modal-content { background:#1e293b; border-radius:16px; padding:2rem; max-width:500px; width:90%; border:1px solid rgba(255,255,255,.08); }
		body.light .modal-content { background:#ffffff; border-color:#e2e8f0; }
		.modal-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:1.5rem; }
		.modal-title { font-size:1.5rem; font-weight:700; }
		.close-btn { background:none; border:none; color:#94a3b8; font-size:1.5rem; cursor:pointer; }
		.form-field { margin-bottom:1rem; }
		.form-field label { display:block; margin-bottom:.5rem; font-weight:600; font-size:.85rem; }
		.form-field input, .form-field select { width:100%; padding:.75rem; border-radius:8px; border:1px solid rgba(255,255,255,.08); background:#0f172a; color:#e2e8f0; }
		body.light .form-field input, body.light .form-field select { background:#f8fafc; border-color:#cbd5e1; color:#0f172a; }
	</style>
</head>
<body>
	<div class="topbar">
		<a href="index.html" class="logo">Elixopay</a>
		<div class="nav-links">
			<a href="dashboard.html"><i class="fas fa-home"></i> Dashboard</a>
			<a href="transactions.html"><i class="fas fa-exchange-alt"></i> Transactions</a>
			<a href="api-keys.html" class="active"><i class="fas fa-key"></i> API Keys</a>
			<a href="docs.html"><i class="fas fa-book"></i> Docs</a>
			<button id="themeToggle" class="btn btn-outline" style="font-size:.8rem; padding:.5rem 1rem;">
				<i class="fas fa-sun"></i>
			</button>
			<button onclick="handleLogout()" class="btn btn-outline" style="font-size:.8rem; padding:.5rem 1rem;">
				<i class="fas fa-sign-out-alt"></i> Logout
			</button>
		</div>
	</div>

	<div class="container">
		<div class="header">
			<h1>üîë API Keys</h1>
			<p>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ API Keys ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö</p>
		</div>

		<div class="card" style="margin-bottom:1.5rem; background:rgba(251,191,36,.1); border-color:rgba(251,191,36,.3);">
			<div style="padding:1.5rem;">
				<div style="display:flex; gap:1rem; align-items:start;">
					<div style="font-size:1.5rem;">‚ö†Ô∏è</div>
					<div>
						<strong style="color:#f59e0b;">Security Warning</strong>
						<p style="margin:.5rem 0 0; font-size:.85rem; color:#94a3b8;">
							‡πÄ‡∏Å‡πá‡∏ö API Keys ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏ß‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏±‡∏ö ‡∏≠‡∏¢‡πà‡∏≤‡πÅ‡∏ä‡∏£‡πå‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ú‡∏¢‡πÉ‡∏ô code repository, frontend, ‡∏´‡∏£‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡πÉ‡∏î‡∏Å‡πá‡∏ï‡∏≤‡∏°
							‡πÉ‡∏ä‡πâ environment variables ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö
						</p>
					</div>
				</div>
			</div>
		</div>

		<div class="card">
			<div class="card-header">
				<h2 class="card-title">API Keys ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h2>
				<button class="btn btn-primary" onclick="showCreateModal()">
					<i class="fas fa-plus"></i> Create New Key
				</button>
			</div>
			<div id="keysContainer">
				<div class="empty-state">
					<i class="fas fa-key" style="font-size:3rem; opacity:.3; display:block; margin-bottom:1rem;"></i>
					‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î API Keys...
				</div>
			</div>
		</div>
	</div>

	<!-- Create API Key Modal -->
	<div class="modal" id="createModal">
		<div class="modal-content">
			<div class="modal-header">
				<h3 class="modal-title">Create New API Key</h3>
				<button class="close-btn" onclick="closeModal()">&times;</button>
			</div>
			<form onsubmit="handleCreateKey(event)">
				<div class="form-field">
					<label for="keyName">Key Name</label>
					<input type="text" id="keyName" placeholder="e.g., Production API" required>
				</div>
				<div class="form-field">
					<label for="keyType">Type</label>
					<select id="keyType" required>
						<option value="test">Test - ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö</option>
						<option value="live">Live - ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á</option>
					</select>
				</div>
				<div style="display:flex; gap:1rem; justify-content:flex-end; margin-top:1.5rem;">
					<button type="button" class="btn btn-outline" onclick="closeModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
					<button type="submit" class="btn btn-primary">‡∏™‡∏£‡πâ‡∏≤‡∏á API Key</button>
				</div>
			</form>
		</div>
	</div>

	<!-- View API Key Modal -->
	<div class="modal" id="viewModal">
		<div class="modal-content">
			<div class="modal-header">
				<h3 class="modal-title">API Key Details</h3>
				<button class="close-btn" onclick="closeViewModal()">&times;</button>
			</div>
			<div style="background:rgba(239,68,68,.1); border:1px solid rgba(239,68,68,.3); padding:1rem; border-radius:8px; margin-bottom:1rem;">
				<strong style="color:#ef4444;">‚ö†Ô∏è ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å API Key ‡∏ô‡∏µ‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</strong>
				<p style="margin:.5rem 0 0; font-size:.85rem; color:#94a3b8;">
					‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô API Key ‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡∏∞‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢
				</p>
			</div>
			<div style="background:rgba(99,102,241,.05); padding:1rem; border-radius:8px; margin-bottom:1rem;">
				<label style="font-size:.85rem; color:#94a3b8; display:block; margin-bottom:.5rem;">API Key:</label>
				<div style="display:flex; gap:.5rem; align-items:center;">
					<code id="newApiKey" style="flex:1; background:#0f172a; padding:.75rem; border-radius:6px; font-size:.85rem; overflow-x:auto;"></code>
					<button class="btn btn-outline" onclick="copyApiKey()" style="padding:.75rem 1rem;">
						<i class="fas fa-copy"></i>
					</button>
				</div>
			</div>
			<button class="btn btn-primary" onclick="closeViewModal()" style="width:100%;">‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÅ‡∏•‡πâ‡∏ß</button>
		</div>
	</div>

	<script>
		// Check authentication
		function checkAuth() {
			const token = localStorage.getItem('token') || localStorage.getItem('authToken');
			if (!token) {
				window.location.href = 'login.html';
				return false;
			}
			return true;
		}

		// Theme toggle
		const themeToggle = document.getElementById('themeToggle');
		themeToggle.addEventListener('click', () => {
			document.body.classList.toggle('light');
			const isLight = document.body.classList.contains('light');
			themeToggle.innerHTML = isLight ? '<i class="fas fa-moon"></i>' : '<i class="fas fa-sun"></i>';
			localStorage.setItem('elixopay-theme', isLight ? 'light' : 'dark');
		});
		if (localStorage.getItem('elixopay-theme') === 'light') {
			document.body.classList.add('light');
			themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
		}

		// Load API Keys
		async function loadApiKeys() {
			const token = localStorage.getItem('token') || localStorage.getItem('authToken');
			const container = document.getElementById('keysContainer');

			try {
				const response = await fetch(apiUrl('/api/v1/api-keys'), {
					headers: {
						'Authorization': `Bearer ${token}`
					}
				});

				if (!response.ok) throw new Error('Failed to load API keys');
				
				const result = await response.json();
				const keys = result.data || [];

				if (keys.length === 0) {
					container.innerHTML = `
						<div class="empty-state">
							<i class="fas fa-key" style="font-size:3rem; opacity:.3; display:block; margin-bottom:1rem;"></i>
							<p>‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ API Keys</p>
							<button class="btn btn-primary" onclick="showCreateModal()" style="margin-top:1rem;">
								<i class="fas fa-plus"></i> ‡∏™‡∏£‡πâ‡∏≤‡∏á API Key ‡πÅ‡∏£‡∏Å
							</button>
						</div>
					`;
					return;
				}

				container.innerHTML = keys.map(key => `
					<div class="key-item">
						<div class="key-info">
							<div class="key-name">
								${key.name}
								<span class="badge badge-${key.type}">${key.type.toUpperCase()}</span>
							</div>
							<div class="key-value">${key.key_prefix}‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢</div>
							<div class="key-meta">
								Created: ${new Date(key.created_at).toLocaleDateString('th-TH')}
								${key.last_used ? `| Last used: ${new Date(key.last_used).toLocaleDateString('th-TH')}` : ''}
							</div>
						</div>
						<div class="key-actions">
							<button class="btn btn-danger" onclick="deleteKey('${key.id}')">
								<i class="fas fa-trash"></i> Delete
							</button>
						</div>
					</div>
				`).join('');
			} catch (error) {
				console.error('Error loading API keys:', error);
				container.innerHTML = `
					<div class="empty-state">
						<i class="fas fa-exclamation-triangle" style="font-size:3rem; opacity:.3; color:#ef4444; display:block; margin-bottom:1rem;"></i>
						<p>‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î API Keys ‡πÑ‡∏î‡πâ</p>
						<button class="btn btn-primary" onclick="loadApiKeys()" style="margin-top:1rem;">
							<i class="fas fa-sync"></i> ‡∏•‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
						</button>
					</div>
				`;
			}
		}

		// Show create modal
		function showCreateModal() {
			document.getElementById('createModal').classList.add('active');
		}

		// Close modal
		function closeModal() {
			document.getElementById('createModal').classList.remove('active');
			document.getElementById('keyName').value = '';
			document.getElementById('keyType').value = 'test';
		}

		// Close view modal
		function closeViewModal() {
			document.getElementById('viewModal').classList.remove('active');
		}

		// Create API Key
		async function handleCreateKey(event) {
			event.preventDefault();
			const token = localStorage.getItem('token') || localStorage.getItem('authToken');
			const name = document.getElementById('keyName').value;
			const type = document.getElementById('keyType').value;

			try {
				const response = await fetch(apiUrl('/api/v1/api-keys'), {
					method: 'POST',
					headers: {
						'Authorization': `Bearer ${token}`,
						'Content-Type': 'application/json'
					},
					body: JSON.stringify({ name, type })
				});

				if (!response.ok) throw new Error('Failed to create API key');

				const result = await response.json();
				const apiKey = result.data.apiKey;

				// Show the key in view modal
				document.getElementById('newApiKey').textContent = apiKey;
				closeModal();
				document.getElementById('viewModal').classList.add('active');

				// Reload keys list
				setTimeout(() => loadApiKeys(), 500);
			} catch (error) {
				console.error('Error creating API key:', error);
				alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á API Key ‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
			}
		}

		// Copy API Key
		function copyApiKey() {
			const apiKey = document.getElementById('newApiKey').textContent;
			navigator.clipboard.writeText(apiKey).then(() => {
				alert('‚úÖ ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å API Key ‡πÅ‡∏•‡πâ‡∏ß!');
			});
		}

		// Delete API Key
		async function deleteKey(keyId) {
			if (!confirm('‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö API Key ‡∏ô‡∏µ‡πâ? ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ')) return;

			const token = localStorage.getItem('token') || localStorage.getItem('authToken');

			try {
				const response = await fetch(apiUrl(`/api/v1/api-keys/${keyId}`), {
					method: 'DELETE',
					headers: {
						'Authorization': `Bearer ${token}`
					}
				});

				if (!response.ok) throw new Error('Failed to delete API key');

				alert('‚úÖ ‡∏•‡∏ö API Key ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
				loadApiKeys();
			} catch (error) {
				console.error('Error deleting API key:', error);
				alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö API Key ‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
			}
		}

		// Logout
		function handleLogout() {
			if (confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
				localStorage.removeItem('token');
				localStorage.removeItem('authToken');
				localStorage.removeItem('user');
				window.location.href = 'login.html';
			}
		}

		// Initialize
		document.addEventListener('DOMContentLoaded', () => {
			if (!checkAuth()) return;
			loadApiKeys();
		});
	</script>
</body>
</html>
