<!DOCTYPE html>
<html lang="th">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>API Keys - Elixopay</title>
	<script src="https://cdn.tailwindcss.com"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
	<script src="/js/api-config.js"></script>
	<script src="/js/auth-guard.js" data-require-role="user"></script>
</head>
<body class="bg-gray-50">
	<nav class="bg-white shadow border-b border-gray-200">
		<div class="max-w-5xl mx-auto px-4 h-14 flex items-center justify-between">
			<div class="flex items-center space-x-3">
				<h1 class="text-xl font-bold text-green-600"><i class="fas fa-key"></i> API Keys</h1>
				<span class="px-2 py-1 text-xs rounded bg-green-100 text-green-700">Secure</span>
			</div>
			<div class="flex items-center space-x-4">
				<a href="/dashboard.html" class="text-sm text-gray-600 hover:text-gray-800"><i class="fas fa-home mr-1"></i>Dashboard</a>
				<span id="user-name" class="text-sm text-gray-700">Loading...</span>
				<button onclick="logout()" class="text-sm text-red-600 hover:text-red-800"><i class="fas fa-sign-out-alt mr-1"></i>‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
			</div>
		</div>
	</nav>

	<main class="max-w-5xl mx-auto px-4 py-8">
		<h2 class="text-2xl font-semibold mb-4">üîê ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ API Keys</h2>
		<p class="text-gray-600 mb-6">‡∏™‡∏£‡πâ‡∏≤‡∏á / ‡∏î‡∏π / ‡πÄ‡∏û‡∏¥‡∏Å‡∏ñ‡∏≠‡∏ô API Keys ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (Token ‡∏ï‡πâ‡∏≠‡∏á‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô)</p>

		<section class="bg-white rounded shadow p-6 mb-6">
			<h3 class="font-semibold mb-3"><i class="fas fa-plus text-blue-600 mr-2"></i>‡∏™‡∏£‡πâ‡∏≤‡∏á Key ‡πÉ‡∏´‡∏°‡πà</h3>
			<div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
				<input id="key-name" type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠ Key" class="px-3 py-2 border rounded" />
				<select id="key-type" class="px-3 py-2 border rounded">
					<option value="test">Test</option>
					<option value="live">Live</option>
				</select>
				<button onclick="createKey()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded">‡∏™‡∏£‡πâ‡∏≤‡∏á</button>
			</div>
			<p class="text-xs text-gray-500">‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡πà‡∏≤ Key ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‚Äì ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</p>
			<pre id="create-output" class="mt-4 text-xs bg-gray-900 text-gray-100 p-3 rounded max-h-48 overflow-auto">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á...</pre>
		</section>

		<section class="bg-white rounded shadow p-6 mb-6">
			<div class="flex items-center justify-between mb-3">
				<h3 class="font-semibold"><i class="fas fa-list text-purple-600 mr-2"></i>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ Keys</h3>
				<button onclick="loadKeys()" class="px-3 py-1 text-sm bg-purple-600 hover:bg-purple-700 text-white rounded"><i class="fas fa-sync mr-1"></i>‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</button>
			</div>
			<table class="w-full text-sm">
				<thead>
					<tr class="text-left text-gray-600 border-b">
						<th class="py-2">ID</th>
						<th class="py-2">‡∏ä‡∏∑‡πà‡∏≠</th>
						<th class="py-2">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
						<th class="py-2">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
						<th class="py-2">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
					</tr>
				</thead>
				<tbody id="keys-table"></tbody>
			</table>
			<pre id="keys-raw" class="mt-4 text-xs bg-gray-900 text-gray-100 p-3 rounded max-h-48 overflow-auto">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÇ‡∏´‡∏•‡∏î...</pre>
		</section>
	</main>

	<script>
		function logout(){ localStorage.clear(); window.location.href='/login.html'; }

		function createKey(){
			const name = document.getElementById('key-name').value.trim();
			const type = document.getElementById('key-type').value;
			if(!name){ alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠'); return; }
			apiFetch('/api/v1/api-keys', { method:'POST', body: JSON.stringify({ name, type }) })
				.then(r=>r.json())
				.then(d=>{
					document.getElementById('create-output').textContent = JSON.stringify(d,null,2);
					loadKeys();
				})
				.catch(e=>{ document.getElementById('create-output').textContent = 'Error: '+e.message; });
		}

		function loadKeys(){
			apiFetch('/api/v1/api-keys')
				.then(r=>r.json())
				.then(d=>{
					document.getElementById('keys-raw').textContent = JSON.stringify(d,null,2);
					const tbody = document.getElementById('keys-table');
					tbody.innerHTML = '';
					const list = d?.data?.apiKeys || [];
					if(list.length===0){
						tbody.innerHTML = '<tr><td colspan="5" class="py-4 text-center text-gray-500">‡πÑ‡∏°‡πà‡∏û‡∏ö Key</td></tr>';
						return;
					}
					list.forEach(k=>{
						const tr = document.createElement('tr');
						tr.className='border-b hover:bg-gray-50';
						tr.innerHTML = `
							<td class='py-2 font-mono text-xs'>${k.id || '-'}</td>
							<td class='py-2'>${k.name || '-'}</td>
							<td class='py-2'>${k.type || '-'}</td>
							<td class='py-2'>${k.status || 'active'}</td>
							<td class='py-2'>
								<button onclick="revokeKey('${k.id}')" class='text-red-600 hover:text-red-800 text-xs'><i class='fas fa-trash'></i> ‡∏•‡∏ö</button>
							</td>`;
						tbody.appendChild(tr);
					});
				})
				.catch(e=>{ document.getElementById('keys-raw').textContent = 'Error: '+e.message; });
		}

		function revokeKey(id){
			if(!confirm('‡∏•‡∏ö key ‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) return;
			apiFetch(`/api/v1/api-keys/${id}`, { method:'DELETE' })
				.then(r=>r.json())
				.then(d=>{ alert('‡∏•‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢'); loadKeys(); })
				.catch(e=> alert('Error: '+e.message));
		}

		document.addEventListener('DOMContentLoaded', loadKeys);
	</script>
</body>
</html>
